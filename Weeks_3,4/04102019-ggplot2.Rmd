---
title: "Ggplot2"
author: "MDP"
date: "10/4/2019"
output: 
  html_document:
    theme: flatly
    toc: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(error = TRUE)
```

# Ggplot2 usage

Set up workspace

```{r, message=FALSE, warning=FALSE, results='hide'}

required <- c('tidyverse', 'gapminder', 'scales')
lapply(required, library, character=T)

```

### Example

```{r}
require(gapminder)

ggplot(gapminder, aes(gdpPercap, lifeExp)) +
  geom_point(alpha = 0.1) +
  scale_x_log10("GDP per capita", labels = scales::dollar_format()) +
  theme_bw() +
  ylab("Life Expectancy")
```

#### Exercise 1: Bar Chart Grammar (Together)

```{r load packages, warning = FALSE}
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(gapminder))
suppressPackageStartupMessages(library(scales))
suppressPackageStartupMessages(library(tsibble))

```

<!---The following chunk allows errors when knitting--->

```{r allow errors, echo = FALSE}
knitr::opts_chunk$set(error = TRUE)
knitr::opts_chunk$set(fig.align = "center")
```

Consider the following plot. Don't concern yourself with the code at this point.

```{r, fig.width = 5, fig.height = 2}
gapminder %>% 
  filter(year == 2007) %>% 
  mutate(continent = fct_infreq(continent)) %>% 
  ggplot(aes(continent)) +
  geom_bar() +
  theme_bw()

# ?fct_infreq organizes a factor according to frequencies
```

Fill in the seven grammar components for this plot.

| Grammar Component     | Specification |
|-----------------------|---------------|
| __data__              | `gapminder` |
| __aesthetic mapping__ | X=continent, y=counts |
| __geometric object__  | Bars   |
| scale                 | None   |
| statistical transform | Counts |
| coordinate system     | Cartesian plane |
| facetting             | None   |

## Mapping inside ggplot

Ggplot function uses the `data` argument and the mapping of variables through aestethics `aes(x=x, y=y)` function used also as `mapping=aes()`

```{r}
ggplot(gapminder, aes(gdpPercap, lifeExp))

ggplot(gapminder, mapping=aes(gdpPercap, lifeExp))

```

- Just initializes the plot, have to include what type of graph you want with a geometric or `geom_SOMETHING`
    + Each layer is added with a **`+`** symbol
    + Alpha is an additional `aestethic` representing transparency

```{r}
ggplot(gapminder, aes(gdpPercap, lifeExp)) +
  geom_point(alpha = 0.1) 

```

- A scale transformation is done using **`scale_AESTHETIC_TRANSFORM()`**
    + In this case we scaled it to Log10 and use a label of dollar format
    
```{r}
ggplot(gapminder, aes(gdpPercap, lifeExp)) +
  geom_point(alpha = 0.1) +
  scale_x_log10("GDP per capita", labels = scales::dollar_format())
```

- A `theme` adds some visual characteristics to the graph
    + Through `ylab`, you can specify the name of the Y axis label
        + Same for` xlab` but it was already entered in the scale
    + To avoid repeating the code line, I save it in an R object

```{r}

plot<- ggplot(gapminder, aes(gdpPercap, lifeExp)) +
  geom_point(alpha = 0.1) +
  scale_x_log10("GDP per capita", labels = scales::dollar_format())

plot + theme_dark()
plot + theme_bw()
plot + theme_void()
plot + theme_minimal()

```
    
